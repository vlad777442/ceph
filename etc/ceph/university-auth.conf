# Ontology-Aware Access Control Configuration for Ceph
# Georgia State University Integration Example

# University SSO Integration
university_sso_enabled = true
university_sso_provider = "duo"  # or "saml2", "oauth2", "oidc"
university_sso_endpoint = "https://sso.gsu.edu"
university_sso_client_id = "ceph-storage-system"
university_sso_client_secret = "${UNIVERSITY_SSO_SECRET}"

# SAML2 Configuration (if using SAML)
university_saml_metadata_url = "https://sso.gsu.edu/metadata"
university_saml_sp_cert_path = "/etc/ceph/saml/sp.crt"
university_saml_sp_key_path = "/etc/ceph/saml/sp.key"
university_saml_idp_cert_path = "/etc/ceph/saml/idp.crt"

# OAuth2/OIDC Configuration (if using OAuth2)
university_oauth_auth_url = "https://sso.gsu.edu/oauth/authorize"
university_oauth_token_url = "https://sso.gsu.edu/oauth/token"
university_oauth_userinfo_url = "https://sso.gsu.edu/oauth/userinfo"
university_oauth_scope = "openid profile email research_access"

# Duo Configuration (if using Duo)
university_duo_integration_key = "${DUO_INTEGRATION_KEY}"
university_duo_secret_key = "${DUO_SECRET_KEY}"
university_duo_api_hostname = "api-xxxxxxxx.duosecurity.com"

# LDAP/Directory Integration
university_ldap_enabled = true
university_ldap_uri = "ldaps://ldap.gsu.edu"
university_ldap_binddn = "cn=ceph-service,ou=services,dc=gsu,dc=edu"
university_ldap_bindpw = "${LDAP_BIND_PASSWORD}"
university_ldap_searchdn = "ou=people,dc=gsu,dc=edu"
university_ldap_searchfilter = "(&(objectClass=person)(uid=@USERNAME@))"
university_ldap_attr_uid = "uid"
university_ldap_attr_department = "department"
university_ldap_attr_role = "title"
university_ldap_attr_projects = "researchProjects"

# Ontology Knowledge Base Configuration
ontology_enabled = true
ontology_config_path = "/etc/ceph/ontology/research-ontology.yml"
ontology_update_interval = 3600  # seconds
ontology_cache_size = 10000  # number of cached ontology queries

# Research Data Classification
data_classification_enabled = true
data_classification_default = "INTERNAL"
data_classification_attribute = "research.data.classification"

# Research Project Integration
research_projects_enabled = true
research_projects_source = "university_system"  # or "file", "database"
research_projects_api_url = "https://research.gsu.edu/api/projects"
research_projects_api_token = "${RESEARCH_API_TOKEN}"

# Collaboration Management
collaboration_enabled = true
collaboration_external_allowed = true
collaboration_approval_required = true
collaboration_approval_workflow = "department_head"

# Path-based Access Control Patterns
# Format: /research/{domain}/{project_id}/{classification}/...
path_pattern_research = "/research/{domain}/{project_id}/{classification}"
path_pattern_shared = "/shared/{department}"
path_pattern_personal = "/users/{username}"
path_pattern_collaboration = "/collaboration/{project_id}/{partner_institution}"

# Fine-grained Permissions
permission_inheritance_enabled = true
permission_override_allowed = false
permission_audit_enabled = true
permission_audit_log_path = "/var/log/ceph/ontology-access.log"

# Access Control Rules Examples
# These would typically be in a separate YAML file referenced by ontology_config_path

rules:
  - name: "Professor Full Research Access"
    conditions:
      role: "professor"
      department_match: true
    permissions:
      - "allow rw path=/research/{user.department}/*"
      - "allow r path=/shared/{user.department}/*"
      - "allow rwps path=/research/{user.department}/{user.projects}/*"
    
  - name: "Graduate Student Project Access"
    conditions:
      role: "graduate_student"
      has_advisor: true
    permissions:
      - "allow rw path=/research/{user.department}/{user.assigned_projects}/*"
      - "allow r path=/shared/{user.department}/public/*"
    
  - name: "Undergraduate Restricted Access"
    conditions:
      role: "undergraduate_student"
    permissions:
      - "allow r path=/shared/{user.department}/public/*"
      - "allow rw path=/users/{user.username}/*"
    
  - name: "External Collaborator"
    conditions:
      role: "external_collaborator"
      collaboration_approved: true
    permissions:
      - "allow rw path=/collaboration/{user.approved_projects}/*"
      - "allow r path=/research/{collaborating_department}/{shared_projects}/*"

  - name: "Data Classification Enforcement"
    conditions:
      always: true
    constraints:
      - "deny path=/research/*/RESTRICTED/* unless user.clearance_level >= RESTRICTED"
      - "deny path=/research/*/CONFIDENTIAL/* unless user.clearance_level >= CONFIDENTIAL"
      - "audit all access to path=/research/*/CONFIDENTIAL/*"
      - "audit all access to path=/research/*/RESTRICTED/*"

# Integration with Existing Ceph Configuration
[auth]
auth_cluster_required = cephx
auth_service_required = cephx
auth_client_required = cephx
auth_university_enabled = true

[mds]
mds_auth_caps_check_ontology = true
mds_auth_caps_ontology_cache_size = 5000
mds_auth_caps_ontology_refresh_interval = 1800

[mon]
mon_auth_university_provider = true
mon_auth_cap_ontology_validation = true

# CephFS Mount Options for University Users
# These would be provided to users for mounting with university credentials
[client]
# Example mount command:
# ceph-fuse /mnt/cephfs -n client.university -k /etc/ceph/ceph.client.university.keyring --university-token="$UNIVERSITY_SSO_TOKEN"
